<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>LeakAlert Notification</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-store" />
  <link rel="icon" href="./favicon.ico">

  <!-- Firebase SDK (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-messaging-compat.js"></script>

  <style>
    *{
      box-sizing:border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body{
      height:100vh;
      margin:0;
      display:flex;
      justify-content:center;
      align-items:center;
      background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    }

    .card{
      background:#ffffff;
      padding:42px 52px;
      border-radius:20px;
      box-shadow:0 20px 45px rgba(0,0,0,.28);
      text-align:center;
      width:340px;
    }

    .icon{ font-size:44px; margin-bottom:8px; }

    h2{ margin:0 0 8px 0; font-size:26px; color:#1f2937; }

    p{ margin:0 0 28px 0; font-size:14px; color:#6b7280; }

    button{
      width:100%;
      border:none;
      padding:15px 28px;
      border-radius:999px;
      font-size:16px;
      font-weight:600;
      cursor:pointer;
      color:#fff;
      background: linear-gradient(135deg,#ff512f,#dd2476);
      box-shadow:0 10px 22px rgba(221,36,118,.45);
      transition: all .2s ease;
    }

    button:hover{
      transform:translateY(-2px);
      box-shadow:0 14px 32px rgba(221,36,118,.6);
    }

    button:active{
      transform:translateY(0);
      box-shadow:0 7px 16px rgba(221,36,118,.45);
    }

    button:disabled{
      background:#9ca3af;
      box-shadow:none;
      cursor:not-allowed;
    }

    .footer{
      margin-top:28px;
      font-size:12px;
      color:#9ca3af;
    }

    /* iOS install overlay */
    #iosInstallOverlay{
      display:none;
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.6);
      z-index:10000;
      align-items:center;
      justify-content:center;
      padding:20px;
    }

    #iosInstallCard{
      background:white;
      border-radius:16px;
      padding:24px 22px;
      max-width:360px;
      text-align:center;
      box-shadow:0 15px 40px rgba(0,0,0,.35);
    }

    #iosInstallCard b{
      font-size:18px;
      display:block;
      margin-bottom:10px;
    }

    #iosInstallCard p{
      font-size:14px;
      margin-bottom:16px;
      color:#374151;
    }

    #iosInstallCard button{
      background:#2563eb;
      box-shadow:none;
    }
  </style>
</head>
<body>

  <!-- banner ‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì -->
  <div id="notifyBanner" style="
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    background:#ff4d4f;
    color:white;
    padding:14px;
    text-align:center;
    font-weight:600;
    z-index:9999;
  ">
  </div>

  <!-- iOS install overlay -->
  <div id="iosInstallOverlay">
    <div id="iosInstallCard">
      <b>‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö iPhone / iPad</b>
      <p>
        ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ß‡πá‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏•‡∏±‡∏Å‡∏Å‡πà‡∏≠‡∏ô<br>
        ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏î‡πâ
        <br><br>
        ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á:
        <br>
        ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° <b>Share</b> ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏á Safari
        <br>
        ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å <b>Add to Home Screen</b>
      </p>
      <button id="closeIosGuide">‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß</button>
    </div>
  </div>

  <div class="card">
    <div class="icon">üîî</div>
    <h2>LeakAlert</h2>
    <p>‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏•‡∏°‡∏£‡∏±‡πà‡∏ß‡∏ú‡πà‡∏≤‡∏ô Browser</p>
    <button id="subscribeBtn">‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</button>
    <div class="footer">
      TTEI ¬∑ Air Leakage Monitoring
    </div>
  </div>

  <noscript>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î JavaScript</noscript>

<script>
const banner = document.getElementById("notifyBanner");
const btn = document.getElementById("subscribeBtn");
const iosOverlay = document.getElementById("iosInstallOverlay");
const closeIosGuide = document.getElementById("closeIosGuide");

function isIOS(){
  return /iphone|ipad|ipod/i.test(navigator.userAgent);
}

function isInStandaloneMode(){
  return window.matchMedia('(display-mode: standalone)').matches
      || window.navigator.standalone === true;
}

function showInitialGuide(){
  banner.innerHTML =
    "üì¢ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î Allow ‡πÉ‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠";
  banner.style.display = "block";
}

function showAddressBarGuide(){
  banner.innerHTML =
    "üì¢ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î Allow ‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô<br><br>" +
    "‚ö†Ô∏è ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô ‡πÉ‡∏´‡πâ‡∏Å‡∏î‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô üîî ‡∏ó‡∏µ‡πà Address Bar ‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤";
}

function hideBanner(){
  banner.style.display = "none";
}

closeIosGuide.addEventListener("click",()=>{
  iosOverlay.style.display="none";
});

btn.addEventListener("click", async () => {

  /* -------------------------
     iOS guard (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)
  --------------------------*/
  if(isIOS() && !isInStandaloneMode()){
    iosOverlay.style.display = "flex";
    return;
  }

  if(!("Notification" in window)){
    alert("Browser ‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Notification");
    return;
  }

  showInitialGuide();

  let resolved = false;

  const permissionPromise = Notification.requestPermission().then(p => {
    resolved = true;
    return p;
  });

  setTimeout(() => {
    if (!resolved && Notification.permission === "default") {
      showAddressBarGuide();
    }
  }, 2000);

  const permission = await permissionPromise;

  if (permission === "granted") {
    hideBanner();
  }

  if (permission === "denied") {
    banner.innerHTML =
      "‚ùå ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏π‡∏Å‡∏ö‡∏•‡πá‡∏≠‡∏Å ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤ Site Settings ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Allow";
    banner.style.display = "block";
  }
});
</script>

<!-- main.js ‡πÄ‡∏î‡∏¥‡∏° -->
<script src="main.js"></script>

</body>
</html>
