<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>LeakAlert Notification</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-store" />
  <link rel="icon" href="./favicon.ico">

  <!-- Firebase SDK (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-messaging-compat.js"></script>

  <style>
    *{
      box-sizing:border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body{
      height:100vh;
      margin:0;
      display:flex;
      justify-content:center;
      align-items:center;
      background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    }

    .card{
      background:#ffffff;
      padding:42px 52px;
      border-radius:20px;
      box-shadow:0 20px 45px rgba(0,0,0,.28);
      text-align:center;
      width:340px;
    }

    .icon{ font-size:44px; margin-bottom:8px; }

    h2{ margin:0 0 8px 0; font-size:26px; color:#1f2937; }

    p{ margin:0 0 28px 0; font-size:14px; color:#6b7280; }

    button{
      width:100%;
      border:none;
      padding:15px 28px;
      border-radius:999px;
      font-size:16px;
      font-weight:600;
      cursor:pointer;
      color:#fff;
      background: linear-gradient(135deg,#ff512f,#dd2476);
      box-shadow:0 10px 22px rgba(221,36,118,.45);
      transition: all .2s ease;
    }

    button:hover{
      transform:translateY(-2px);
      box-shadow:0 14px 32px rgba(221,36,118,.6);
    }

    button:active{
      transform:translateY(0);
      box-shadow:0 7px 16px rgba(221,36,118,.45);
    }

    .footer{
      margin-top:28px;
      font-size:12px;
      color:#9ca3af;
    }

    #notSupportedMsg{
      display:none;
      margin-top:12px;
      font-size:14px;
      color:#dc2626;
      font-weight:600;
    }

    #notifyBanner{
      display:none;
      position:fixed;
      top:0;
      left:0;
      width:100%;
      background:#ff4d4f;
      color:white;
      padding:14px;
      text-align:center;
      font-weight:600;
      z-index:9999;
    }
  </style>
</head>
<body>

  <div id="notifyBanner"></div>

  <div class="card">
    <div class="icon">üîî</div>
    <h2>LeakAlert</h2>
    <p>‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏•‡∏°‡∏£‡∏±‡πà‡∏ß‡∏ú‡πà‡∏≤‡∏ô Browser</p>

    <button id="subscribeBtn">‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</button>

    <div id="notSupportedMsg">
      ‚ùå ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏´‡∏£‡∏∑‡∏≠ Browser ‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
    </div>

    <div class="footer">
      TTEI ¬∑ Air Leakage Monitoring
    </div>
  </div>

  <noscript>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î JavaScript</noscript>

<script>
const banner = document.getElementById("notifyBanner");
const btn = document.getElementById("subscribeBtn");
const notSupportedMsg = document.getElementById("notSupportedMsg");

function isIOS(){
  return /iphone|ipad|ipod/i.test(navigator.userAgent);
}

function isPushSupported(){
  if (isIOS()) return false; // FCM ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö iOS
  if (!("Notification" in window)) return false;
  if (!("serviceWorker" in navigator)) return false;
  return true;
}

function showInitialGuide(){
  banner.innerHTML =
    "üì¢ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î Allow ‡πÉ‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠";
  banner.style.display = "block";
}

function showAddressBarGuide(){
  banner.innerHTML =
    "üì¢ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î Allow ‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô<br><br>" +
    "‚ö†Ô∏è ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô ‡πÉ‡∏´‡πâ‡∏Å‡∏î‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô üîî ‡∏ó‡∏µ‡πà Address Bar ‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤";
}

function hideBanner(){
  banner.style.display = "none";
}

document.addEventListener("DOMContentLoaded", () => {

  if (!isPushSupported()) {
    btn.style.display = "none";
    notSupportedMsg.style.display = "block";
    return;
  }

  notSupportedMsg.style.display = "none";

  btn.addEventListener("click", async () => {

    showInitialGuide();

    let resolved = false;

    const permissionPromise = Notification.requestPermission().then(p => {
      resolved = true;
      return p;
    });

    setTimeout(() => {
      if (!resolved && Notification.permission === "default") {
        showAddressBarGuide();
      }
    }, 2000);

    const permission = await permissionPromise;

    if (permission === "granted") {
      hideBanner();
      if (window.subscribeFCM) {
        await window.subscribeFCM();
      } else {
        console.error("subscribeFCM is not loaded");
      }
    }

    if (permission === "denied") {
      banner.innerHTML =
        "‚ùå ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏π‡∏Å‡∏ö‡∏•‡πá‡∏≠‡∏Å ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤ Site Settings ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Allow";
      banner.style.display = "block";
    }

  });

});
</script>

<!-- main.js -->
<script src="main.js"></script>

</body>
</html>
